<strong id="tittle">Kho hàng</strong>
<button type="button" id="add-head" data-toggle="modal" data-target="#myModal" class="btn btn-primary btn-sm ctr-btn"><i class="fa fa-plus" aria-hidden="true"></i> Nhập kho hàng</button>
<form action="#" name="f-update" method="POST" autocomplete="on">
    <input type="hidden" id="key" name="key" value="-1" />
    <select id="branch" class="form-control ctr-1x">
        <option value="-1">Chi nhánh ...</option>
    </select>
    <select id="category" class="form-control ctr-1x">
        <option value="-1">Danh mục hàng ...</option>
    </select>
    <input type="text" id="address" class="form-control ctr-1x" name="address" placeholder="Tên hoặc Mã sản phẩm cần tìm ..." title="Tên hoặc Mã sản phẩm cần tìm ..." />
    <button type="submit" id="update" name="action" value="update" class="btn btn-success btn-sm ctr-btn"><i class="fa fa-search" aria-hidden="true"></i> Tìm kiếm ...</button>
</form>
<div id="view" class="d-clear"></div>
<script>
    $(document).ready(function(){
        $("#d-fixheight").attr('style', 'max-height: ' + ($('#d-contain').height() - $("#view").offset().top - 10) + "px;");
        $(window).resize(function(){
            $("#d-fixheight").attr('style', 'max-height: ' + ($('#d-contain').height() - $("#view").offset().top - 10) + "px;");
        });
    });
</script>
<div class="table-responsive d-table" id="d-fixheight">
    <table class="table table-hover table-condensed table-striped">
        <thead>
        <tr>
            <th>#</td>
            <th>Sản phẩm</th>
            <th>Giá Bán</th>
            <th>Số lượng</th>
            <th>Phân loại</th>
            <th>Chi nhánh</th>
            <th></th>
        </tr>
        </thead>
        <tbody>
        <% for(i=0; i<data.length; i++) { %>
        <tr onclick="infopartner('<%= data[i].ProductId %>');" title="Click để xem thông tin chi tiết mặt hàng" >
            <td><%= data[i].ProductId %></td>
            <td><%= data[i].ProductName %></td>
            <td><%= data[i].Price %></td>
            <td><%= (data[i].NewNumber + data[i].OldNumber) %></td>
            <td><%= data[i].CategoryName %></td>
            <td><%= data[i].BranchName %></td>
            <td class="col-action">
                <i class="fa fa-question-circle ctr-action" aria-hidden="true"></i>
                <i class="fa fa-trash ctr-action" onclick="deletepartner('<%= data[i].ProductId %>');" aria-hidden="true"></i>
            </td>
        </tr>
       <% } %>
        </tbody>
        <tfoot>
            <tr>
                <td colspan="7" id="viewmore" onclick="searchpersonnel()"><i class="fa fa-angle-double-down" aria-hidden="true"></i> xem thêm ...</td>
            </tr>
        </tfoot>
    </table>
</div>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">Thêm hàng vào kho</h4>
      </div>
      <div class="modal-body">
            <form action="/update/personnel" id="f-update" name="f-update" method="POST" autocomplete="on">
                <input type="hidden" id="keymodel" name="key" />
                <input type="text" id="usernamemodel" class="form-control ctr-1x" name="username" placeholder="(*) Sản phẩm ..." />
                <select id="branchmodel" class="form-control ctr-1x" name="branch" placeholder="(*) Chi nhánh ..."></select>
                <select id="categorymodel" class="form-control ctr-1x" name="category" placeholder="(*) Danh mục ..."></select>
                <select id="suppliermodel" class="form-control ctr-1x" name="supplier" placeholder="(*) Nhà cung cấp"></select>
                <input type="text" id="fullnamemodel" class="form-control ctr-1x" name="fullname" placeholder="(*) Số lượng nhập ..." />
                <input type="text" id="identitycardmodel" class="form-control ctr-1x" name="identitycard" placeholder="(*) Giá nhập ..." />
                <input type="text" id="addressmodel" class="form-control ctr-1x" name="address" placeholder="(*) Giá bán ..." />
                
            </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Hủy</button>
        <button type="button" onclick="$('#f-update').submit();" class="btn btn-primary">Cập nhật</button>
      </div>
    </div>
  </div>
</div>

<script>
    $(document).ready(function(){
        $.ajax({
            url: "/loaddata/warehouse",
            type: "GET",
            data: {
                ops: 1
            },
            success: function(data){
                if(data.length>0) {
                    var html = "";
                    for(var i=0; i<data[0].length; i++) {
                        html += "<option id='br"+data[0][i].IdBranch+"' value='"+data[0][i].IdBranch+"'>"+data[0][i].NameBranch+"</option>";
                    }
                    $('#branch').append(html);
                    $('#branchmodel').append(html);
                    html = "";
                    for(var i=0; i<data[1].length; i++) {
                        html += "<option id='ct"+data[1][i].IdCategory+"' value='"+data[1][i].IdCategory+"'>"+data[1][i].Name+"</option>";
                    }
                    $('#category').append(html);
                    $('#categorymodel').append(html);
                    html = "";
                    for(var i=0; i<data[2].length; i++) {
                        html += "<option id='sp"+data[2][i].IdSupplier+"' value='"+data[2][i].IdSupplier+"'>"+data[2][i].ContactName+"</option>";
                    }
                    $('#suppliermodel').append(html);
                }
            },
            error: function(){
                alert("Không cập nhật được cơ sở dữ liệu!!!\nVui lòng thao tác lại sau.");
                }
            });
        
        $("form[name='f-update']").validate({
            rules : {
                name: "required",
                delegate: 'required',
                address: 'required',
                phone: {
                    required: true,
                    digits: true,
                    minlength: 10,
                    maxlength: 20,
                },
                email: 'email'
            },
            messages : {
                name: 'Bạn chưa nhập dữ liệu cho trường này!',
                delegate: 'Bạn chưa nhập dữ liệu cho trường này!',
                address: 'Bạn chưa nhập dữ liệu cho trường này!',
                phone: {
                    required: "Bạn chưa nhập dữ liệu cho trường này!",
                    digits: "Hãy nhập số điện thoại!",
                    minlength: "Hãy nhập số điện thoại!",
                    maxlength: "Hãy nhập số điện thoại!",
                },
                email: 'Hãy nhập định dạng email!'
            },
            submitHandler : function(form) {
                var event = $(form).serializeArray()[6].value;
                if(event == "add")
                    updatepartner(true);
                else
                    updatepartner(false);
            }
        });    
    });
</script>